<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Fitboard by ctaloi</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Fitboard</h1>
        <h2>Source of fitboard.me</h2>
        <a href="https://github.com/ctaloi/Fitboard" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a name="about-fitboard" class="anchor" href="#about-fitboard"><span class="octicon octicon-link"></span></a>About Fitboard</h1>

<p><a href="http://fitboard.me">Fitboard.me</a> is a webapp built to connect the <a href="http://dev.fitbit.com/">Fitbit API</a> to <a href="https://panic.com/statusboard/">Panic's Status Board</a> iPad application.  Fitboard is free for anyone to use at <a href="http://fitboard.me">Fitboard.me</a> or you can fork the repo and build your own.</p>

<p>The source for Fitbit is open - please contribute.</p>

<p>Fitboard allows you to visualize</p>

<ul>
<li>Steps</li>
<li>Calories</li>
<li>Distance</li>
<li>Floors</li>
<li>Active Score</li>
<li>Minutes Asleep</li>
<li>Sleep Efficiency</li>
<li>Times Awakened</li>
</ul><p>And a multi point graph showing</p>

<ul>
<li>Minutes Sedentary</li>
<li>Minutes Lightly Active</li>
<li>Minutes Fairly Active</li>
<li>Minutes Very Active</li>
</ul><p>Over</p>

<ul>
<li>1 Day</li>
<li>7 Days</li>
<li>1 Month</li>
<li>3 Months</li>
<li>6 Months</li>
<li>1 Year</li>
<li>Max</li>
</ul><p>In Status Board on your iPad</p>

<p>Fitboard depends heavily on the following <strong>awesome</strong> Python packages:</p>

<ul>
<li><a href="https://github.com/orcasgit/python-fitbit">Python FitBit API Client</a></li>
<li><a href="http://flask.pocoo.org/">Flask</a></li>
</ul><p>You can see the full list of packages in <a href="https://github.com/ctaloi/Fitboard/blob/master/requirements.txt">requirements.txt</a></p>

<hr><h1>
<a name="building-fitboard" class="anchor" href="#building-fitboard"><span class="octicon octicon-link"></span></a>Building Fitboard</h1>

<p>You should be able to deploy Fitboard locally, to a VPS or on Heroku with minimal configuration changes.</p>

<h3>
<a name="local-build" class="anchor" href="#local-build"><span class="octicon octicon-link"></span></a>Local Build</h3>

<p>Use <a href="http://virtualenvwrapper.readthedocs.org/en/latest/command_ref.html">Virtualenv Wrapper</a> to manage virtual environments</p>

<p>Create a new virtual environment</p>

<pre><code>mkvirtualenv fitboard
</code></pre>

<h3>
<a name="clone-fitboard" class="anchor" href="#clone-fitboard"><span class="octicon octicon-link"></span></a>Clone fitboard</h3>

<pre><code>cd ~/Projects
git clone https://github.com/ctaloi/Fitboard.git
</code></pre>

<h3>
<a name="install-fitboard-requirements" class="anchor" href="#install-fitboard-requirements"><span class="octicon octicon-link"></span></a>Install Fitboard Requirements</h3>

<pre><code>cd ~/Projects/Fitboard
workon fitboard
pip -r install requirements.txt
</code></pre>

<h3>
<a name="use-sqlite" class="anchor" href="#use-sqlite"><span class="octicon octicon-link"></span></a>Use SQLite</h3>

<p>Set your config.py file for local SQLite</p>

<pre><code># if sqlite, uncomment the next two lines
basedir = os.path.abspath(os.path.dirname(__file__))
SQLALCHEMY_DATABASE_URI = 'sqlite:///' + os.path.join(basedir, 'app.db')

# else
# SQLALCHEMY_DATABASE_URI = os.environ['DATABASE_URL']
</code></pre>

<h3>
<a name="get-connected" class="anchor" href="#get-connected"><span class="octicon octicon-link"></span></a>Get Connected</h3>

<p>In order to talk to the Fitbit API you need to <a href="https://dev.fitbit.com/apps/new">sign up</a> and obtain a key and secret.</p>

<p>Completing the registration request is easy.</p>

<ul>
<li>Default access type: Read-Only</li>
<li>Application Type: Browser</li>
</ul><p>Save your CONSUMER_KEY and CONSUMER_SECRET</p>

<h2>
<a name="heroku-deployment" class="anchor" href="#heroku-deployment"><span class="octicon octicon-link"></span></a>Heroku Deployment</h2>

<p>Install <a href="https://toolbelt.heroku.com/">Heroku Toolbelt</a></p>

<p>Follow the Getting started with Flask and Heroku <a href="https://devcenter.heroku.com/articles/python">guide</a> for setting up your Heroku Deployment</p>

<p>Add Postgres addon</p>

<pre><code>heroku addons:add heroku-postgresql:dev
</code></pre>

<p>Promote the database</p>

<pre><code>heroku pg:promote HEROKU_POSTGRESQL_TEAL_URL
</code></pre>

<p>This sets up Postgres and sets the heroku config DATABASE_URL for us.  To create and populate the database table we need to use a heroku python shell</p>

<pre><code>heroku run python
&gt;&gt;&gt; from main import db
&gt;&gt;&gt; db.create_all()
</code></pre>

<p>You can use this Postgres instance locally or deployed</p>

<h2>
<a name="standalone-deployment" class="anchor" href="#standalone-deployment"><span class="octicon octicon-link"></span></a>Standalone Deployment</h2>

<p>Flask can also run under a standalone WSGI container - <a href="http://flask.pocoo.org/docs/deploying/wsgi-standalone/">more detail and options</a></p>

<p>I've tested with the following stack:</p>

<ul>
<li><a href="http://flask.pocoo.org/">Flask</a></li>
<li><a href="http://gunicorn.org/">Gunicorn</a></li>
<li><a href="http://nginx.org/">NGINX</a></li>
<li><a href="https://pypi.python.org/pypi/supervisor">Supervisor</a></li>
</ul><h3>
<a name="summary-of-standalone-configuration" class="anchor" href="#summary-of-standalone-configuration"><span class="octicon octicon-link"></span></a>Summary of standalone configuration</h3>

<p>Basically - Supervisor starts Gunicorn who starts the fitboard app</p>

<h4>
<a name="supervisor" class="anchor" href="#supervisor"><span class="octicon octicon-link"></span></a>Supervisor</h4>

<p>config: /etc/supervisor/conf.d/fitboard.conf</p>

<pre><code>[program:gunicorn]
command=/home/chris/Envs/fitboard/bin/gunicorn -w 4 -b 127.0.0.1:8000 main:app
directory=/home/chris/Projects/Fitboard
user=chris
autostart=true
autorestart=true
redirect_stderr=True
environment=CONSUMER_KEY="XXX",CONSUMER_SECRET="XXX",DATABASE_URL="XXX",SECRET_KEY="XXX"
</code></pre>

<h4>
<a name="nginx" class="anchor" href="#nginx"><span class="octicon octicon-link"></span></a>NGINX</h4>

<p>config: /etc/nginx/sites-available/fitboard (symlink in sites-enabled)</p>

<pre><code>server {
    listen 80;
    server_name fitboard.me;
    access_log  /var/log/nginx/fitboard.log;

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
  }
</code></pre>

<h4>
<a name="gunicorn" class="anchor" href="#gunicorn"><span class="octicon octicon-link"></span></a>Gunicorn</h4>

<p>Gunicorn is configured in the supervisor config file</p>

<h2>
<a name="start-fitboard" class="anchor" href="#start-fitboard"><span class="octicon octicon-link"></span></a>Start Fitboard</h2>

<h3>
<a name="local" class="anchor" href="#local"><span class="octicon octicon-link"></span></a>Local</h3>

<ul>
<li>Edit config.py and set debug to True</li>
</ul><p>To start Fitboard running under Flask debug mode (local - non production) you need to setup your environmental variables using the CONSUMER_KEY and CONSUMER_SECRET provided by Fitbit and other 'secure' variables of your deployment.</p>

<p>I have a shell script which runs the following</p>

<pre><code>export CONSUMER_KEY=
export CONSUMER_SECRET=
export DATABASE_URL=
export SECRET_KEY=
export MAIL_USERNAME=
export MAIL_PASSWORD=
./python main.py
</code></pre>

<h3>
<a name="heroku" class="anchor" href="#heroku"><span class="octicon octicon-link"></span></a>Heroku</h3>

<p>Set your variables using the Heroku CLI</p>

<pre><code>heroku config:set SECRET_KEY=
heroku config:set CONSUMER_KEY=
heroku config:set CONSUMER_SECRET=
heroku config:set MAIL_USERNAME=
heroku config:set MAIL_PASSWORD=
heroku config:set DATABASE_URL=
</code></pre>

<h3>
<a name="standalone" class="anchor" href="#standalone"><span class="octicon octicon-link"></span></a>Standalone</h3>

<p>Your environmental variables are called in the your supervisor config</p>

<p>config: /etc/supervisor/conf.d/fitboard.conf</p>

<pre><code>[program:gunicorn]
command=/home/chris/Envs/fitboard/bin/gunicorn -w 4 -b 127.0.0.1:8000 main:app
directory=/home/chris/Projects/Fitboard
user=chris
autostart=true
autorestart=true
redirect_stderr=True
environment=CONSUMER_KEY="XXX",CONSUMER_SECRET="XXX",DATABASE_URL="XXX",SECRET_KEY="XXX"

service nginx restart
service supervisor restart
</code></pre>

<p>Supervisor will trigger Gunicorn and Fitboard</p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/ctaloi/Fitboard/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/ctaloi/Fitboard/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/ctaloi/Fitboard"></a> is maintained by <a href="https://github.com/ctaloi">ctaloi</a>.</p>

          <p>This page was generated by <a href="pages.github.com">GitHub Pages</a> using the Architect theme by <a href="http://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>